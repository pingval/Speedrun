<!-- TOC depthFrom:1 depthTo:2 -->

- [参考](#参考)
- [解説ポイント](#解説ポイント)

<!-- /TOC -->

## 参考

### DQ7セーブデータ改竄RTAの歴史
- [**【ゆっくり実況】ドラゴンクエスト7 セーブデータ改ざんRTA　0:14:04**](https://www.nicovideo.jp/watch/sm35205981) - 全ての元凶
- [PS版DQ7 セーブデータ改竄RTA in 5:05](https://github.com/pingval/DQ7/blob/master/rta-saveglitch-20190623-00h05m05s.md)
- [PS版DQ7 セーブデータ改竄RTA in 3:16](https://github.com/pingval/DQ7/blob/master/rta-saveglitch-20190623-00h03m16s.md)
- [【ドラゴンクエスト7 RTA 2:50.46】セーブデータ改ざん利用【VOICEROID実況】](https://www.nicovideo.jp/watch/sm35362422)
- [PS版DQ7 セーブデータ改竄RTA in 2:23](https://github.com/pingval/DQ7/blob/master/rta-saveglitch-20190905-00h02m23s.md)

### 最新のDQ7セーブデータ改竄RTA
- [PS版DQ7 セーブデータ改竄RTA in 2:19](https://www.twitch.tv/videos/479533277)
- [PS版DQ7 セーブデータ改竄RTA 一発勝負エディション in 5:58](https://www.twitch.tv/videos/500245824)
- [PS版DQ7 セーブデータ改竄 魚と手紙RTA 一発勝負エディション in 4:43](https://www.twitch.tv/videos/500248880)
- [攻略チャート](https://github.com/pingval/DQ7/blob/master/psdq7-saveglitch-chart.txt)
  - [一発勝負エディション](https://github.com/pingval/DQ7/blob/master/psdq7-saveglitch-race-chart.txt)

### ヴァルキリープロファイルのsaveglitch
- [TASVideos submissions: #6046: N?K's PSX Valkyrie Profile "save glitch" in 17:42.89](http://tasvideos.org/6046S.html) - 全ての元凶の元凶の元凶
- [【解説編集動画】ヴァルキリープロファイル SRAM glitch RTA in 0:31:09](https://www.youtube.com/watch?v=rUprd-w0GKM) - 全ての元凶の元凶
- [RTA in Japan Online 2 - ヴァルキリープロファイル](https://www.twitch.tv/videos/296184688)

### その他のアニメティカ利用プレイ
- ping値
  - [PS版FF8 セーブデータ改竄RTA in 27:46](https://github.com/pingval/Speedrun/blob/master/FF8/rta-saveglitch-20190708-00h27m46s.md)
  - [PS版FF7 セーブデータ改竄RTA in 28:44](https://github.com/pingval/Speedrun/blob/master/FF7/rta-saveglitch-20190718-00h28m44s.md)
  - [PS版FF9 セーブデータ改竄RTA in 21:11](https://github.com/pingval/Speedrun/blob/master/FF9/rta-saveglitch-20190721-00h21m11s.md)
  - [PS版DQ4 セーブデータ改竄RTA in 3:36](https://github.com/pingval/Speedrun/blob/master/DQ4/rta-saveglitch-20190728-00h03m36s.md)
  - [PS版FF7-8-9 セーブデータ改竄RTAリレー in 1:16:16](https://github.com/pingval/Speedrun/blob/master/FF789/rta-saveglitch-20190815-01h16m16s.md)
- おやつ氏
  - [TASさんがぼくなつを1泊2日でクリア（アニメティカ使用）](https://www.youtube.com/watch?v=5oKdSvFTdC0)
  - [実機でできる！既存のPS1セーブデータを改造する方法](https://www.youtube.com/watch?v=U_6tM_A_xNY) - 既存のセーブデータを編集する手法を開発
  - [【サガフロ2】連携最大ダメージに挑戦【アニメティカ使用】](https://www.youtube.com/watch?v=a3LPt5YFwbU)
- るなそる氏
  - [モンスターファーム RTA 5:22.36(アニメティカ使用)](https://www.youtube.com/watch?v=LN41964EZGA)
- yagamuu氏
  - [【VOICEROID実況】アークザラッド2 セーブデータ改ざん利用RTA 12:44](https://www.youtube.com/watch?v=k9REGfqWmow)

### 文献
- [RPGツクール3を使ったPS1セーブデータの改ざん方法 | RTAPlay!](https://rta-play.info/tool/save-glitch/)
- [今巷でセーブデータを改ざんするRTAが話題となっているらしい！【PS版ドラゴンクエスト7】 | RTA News](https://www.rta-news.com/2019/06/25/249/)
- [アニメティカでのセーブデータ改ざん発見までの流れ:内容の浅い資料集（仮） - ブロマガ](https://ch.nicovideo.jp/tdtd/blomaga/ar1806330)
- [プレイステーション・ＰＡＤ／メモリ・インターフェースの解析](http://kaele.com/~kashima/games/ps_jpn.txt) - ５．メモリカード・フォーマット

----

## 解説ポイント

### つかみ

- ping値はDQ7が3分足らずでクリアできることに興奮して、当初はこのRTA in Japanでタイマントーナメントを開く野望を抱いていたが、プレイヤー人口が足りず断念！ｗ
  - 夏頃に大会を開いたが参加者は主催を含め3名。ひとりはロマサガ仙人こと白鴉(HAKUA)さん。もうひとりが今回の並走相手のyagamuuさん。
- プレイヤー紹介(気に入らなかったら好きに変えてね！！)
  - ping値
    - 東方STGとかDQ7とかFF8とかをRTA。RTA in Japanでは、東方文花帖、DQ5、東方花映塚を走った。
    - さっき東方永夜抄走りました(予定)。
    - 今年はDQ7の北米版に手を出す予定だったが、アニメティカの発見に触発されてセーブーデータ改竄RTAをいろいろやっていた。DQ7以外ではFF789とDQ4。北米版DQ7も改竄RTAした。
    - 自己ベは2:19(最速記録)。
  - yagamuu
    - DQ1,2とかアークザラッドシリーズとかローグライクをRTA。RTA in Japanでは、アークザラッド・美味しんぼ・モンスタファーム2を走った。内藤九段将棋秘伝トーナメントで優勝し内藤九段位を獲得したのは記憶に新しいところ。
    - アークザラッド2を改竄RTAした。
    - 自己ベは2:30。
  - アジーン(解説)
    - RTAは解説専。RTA in Japanでは、DQ5・ドンキーコングジャングルビート・モンスターファーム2・最強羽生将棋・スーパーマリオブラザーズ・テニスの王子様・DQ3を解説。
    - さっき東方永夜抄解説しました(予定)。

### 走る前に

- アニメティカ発見に至る歴史
  - [VPのセーブ中にリセットするTAS](http://tasvideos.org/6046S.html)
    - > This glitch possible do in real time, maybe can abuse to any speedrun (I'm not sure their rule have allow or not)
    - を参考にもかさんが、セーブ中にメモリーカードを抜くVP SRAM glitch RTAを走る
      - をきっかけにとどトドさんが0埋めする方法を探すうち、アニメティカの発見に至る
- RTA in Japanにおいて、セーブ中にメモカを抜くRTAは、もかさんが既にRiJO2でVPのsaveglitchをやっている！
  - 普通のDQ7のRTAは、2017年のRTA in Japan for #C4LANJPにおいて、現行最速記録(12:49:48)保持者のけったさんによって走られた。一発勝負で13時間を切る12:57:19という素晴らしい走り。
- データを読み込ませる原理
  - アニメティカのデータに自分をDQ7のデータだと思い込ませる作業。
  - 既にわかりやすい解説が出回っているのでここではパス！
- アニメティカでどんなデータを作るか
  - DQ7のセーブデータには「現在いるマップ」が保存されている。ここに「THE END画面」を指定する(アニメティカで描き込む)。
  - DQ7のセーブデータは124バイトごとに4バイトのチェックサム(データの破損を検出するための機構; DQ7の場合はCRC32の一種)がある。チェックサムが異常だと、壊れた冒険の書扱いで読み込めない。
  - 更に、チェックサムではないが描き込まないと壊れた冒険の書扱いになるマスもある。
  - 「チェックサムが0(描き込み不要)になる」かつ「使う色や塗るマスの数がなるべく少なくなる」ような塗り方を探索するスクリプトを書いて、(おそらく)理想的な塗り方を見つけた。
  - 普通はDISC 2でエンディングを見るが、DISC 1でも見ることができる。しかも、DISC 1用データのほうが描き込むマスが少ないので、DISC 1用のデータを作る。
  - 1マスでも描き間違えているとチェックサム異常が検出されてロードできないため、細心の注意を払って描く。一発勝負用の安定策はあるが、これをミスるとどうにもならない。
- DQ7はセーブデータ改竄RTAへの適性がやばい。
  - ゲームの開始直後にセーブできる！(FF7はセーブまで約7分掛かる)
  - ロード直後に計測終了地点をもってこれる！(FF7は約19分)
  - DISC 2枚組なのにDISC交換が要らない！(FF7はDSIC 3にしか存在しないムービーの一部が計測終了地点なので要る)
  - セーブーデータ改竄RTAなら3分かそこらだが普通に走ると13時間も掛かる！  - セーブデータ改竄RTAの題材としてDQ7を最初に選択したとどトドさんの慧眼に脱帽といったところ
- 運要素
  - DQ7でメモリーカードの引き抜き時、たまにPS2本体がフリーズする。20sロス。
  - アニメティカの拡大回数が少ない場合、狙ったマス目への移動に要求される操作精度が高すぎるので実質運。

### アニメティカパート

- 使用するメモリーカードにデータがあると読み込みロスが増えるので、データは全て削除しておく。
- 以下のタイミングはメモリーカードを挿入していると1,2s程度の読み込みロスが発生する。抜いておくこと。ただしいつでも挿入できるような位置に置いておく。
  - PS2電源投入時
  - RPGツクール3起動時
  - DQ7起動時
- PS2の電源投入と同時にタイマースタート。まずはPS2の高速読み込み設定を行う
  - 電源投入の約0.8s以上経過後に一度リセットしておけば、リセットしても高速読み込みが解除されない(ping値が発見)。
- RPGツクール3のOPデモは空想科学の爆音注意
  - なんと北米版ではOPデモを全部飛ばせる。騒音の苦情でもあったのか？
- 『アニメティカ』→『RPGデータをつくる』→『タイトルをかく』を選択する。
- キャンバスの拡大率がそのままだと精密操作がつらすぎるので1回拡大(それでもつらい)。yagamuuさんは2回拡大？
- 真っ白なキャンバスは`01`で塗りつぶされている状態なので、まずは`00`で塗りつぶす。
- R1ボタンを押しながらカーソルを動かすとカーソルの移動速度が上がる。
- まずは目印になる、色つきの`07`から描き込む。
  - 初期はどのマスに描き込んだかわかるように背景色を変更していたが、その手間まで惜しんだ結果、現在は黒背景に黒色を描き込む光景が繰り広げられることとなった。
- ミスした場合のリカバリ
  - ×ボタンがスポイトツール。背景色を吸い取り、間違って描き込んだマスに上書きする。
```
通常:
y\x| 40          44          48 49 50                                                                         75    77 78 79
---+------------------------------------------------------------------------------------------------------------------------
 27| 34          07          D0 07 08                                                                         24    24 24 07

魚と手紙:
y\x| 41 42                48 49 50    52                                     65                                     78 79
---+---------------------------------------------------------------------------------------------------------------------
 27| 21 07                D0 07 08    07                                     B7                                     21 07

※座標は10進数表記、色は16進数表記
- x座標48~51: d0 07 08 00 を描き込まないと壊れた冒険の書になる
- x座標78~79: MapID(通常: 0x0724, 魚と手紙: 0x0721)
- それ以外: チェックサムを0に調整するための描き込み
```
- 一発勝負における安定策
  - 2ブロック目に描き込んだデータをお絵かきツールでコピーして、3,4,5ブロック目にあたる位置に貼り付ける。メモカ抜きに挑戦できるデータが4個できる。
  - 圧縮セーブ終了までちゃんと待つ。4個のデータ全て失敗しても、圧縮データをロード→無圧縮セーブ→圧縮セーブとすることで、またやり直せる。
  - これらの安定策は、実は全ての元凶であるとどトドさんの動画の中にある。
- ファイルの名前がないとセーブできないので、適当に入力。
  - 操作に僅かな空白が生まれるこのタイミングで初めてメモリーカードを挿入する！
- まずは無圧縮セーブ。セーブ中にトレイを開けて『RPGツクール3』から『DQ7のDISC 1』へ交換。
  - アニメティカのお絵かき中はDISCが読み込まれないので、DISC交換タイミングはここがベスト。
  - 最速狙いチャートだと時間的余裕があまりないが、一発勝負なら3ブロック分余計に書き込む分、割と余裕がある。
- 「残り 3ブロック」と表示されたらメモリーカードを抜く。
  - 不思議なことに、ここでメモリーカードを抜いたときにフリーズした経験がない。DQ7はもちろん、FF789でもセーブ中に抜いたときのフリーズは必ず経験しているのに。
- 次に圧縮セーブを行う。無圧縮セーブと同じタイミングでメモリーカードを挿入する。
- 最速狙いならリセットするタイミングは圧縮セーブが始まるか始まらないかくらいだが、一発勝負なので圧縮セーブが終わってからリセット。

### DQ7パート

- まずはPS2起動時とDQ7起動時のロスを防ぐためメモリーカードを抜く。ENIXのロゴが表示されたら挿入する。
- 『ぼうけんのしょをつくる』を選択する。
  - セーブデータ改竄RTAでは、名前に何を入力しても本編に反映されないので速くかつ入力が簡単な「ああああ」でよい。
- 連打し続けてスロット1のメモリーカードの1番目にセーブし、「抜き差ししないで下さい。」の句点が表示された直後(管理ブロックだけ書き込まれたタイミング)に引き抜く。
  - 引き抜くタイミングの猶予は恐らく、60fpsで2f (0.033s)。
  - 引き抜く際たまにフリーズする(体感で1/3くらい？)。リセットするしかない(20sロス)。フリーズしてもデータの書き換えは成功しているということもある。
  - マイクロ秒とか言う単位が飛び出すSFCのサブフレームリセット利用RTAほどシビアではないが許してやってほしい。
- メモリーカードの中身を確認し、
  - 「　　　Lv27」というデータがある: 成功。メニューに戻って『ぼうけんをする』からデータをロードする。
    - ただし、ロードして「壊れている可能性があります。」と表示された場合は、残念ながらアニメティカのお絵描きに失敗している。絵を描くとこからやり直し！
  - 冒険の書がない: 引き抜くタイミングが早い。失敗だが、データは何も変更されていないのでそのブロックを使ってリトライできる。
  - こわれた冒険の書がある: 引き抜くタイミングが遅い。データが変更されているため、そのブロックではリトライできない。
  - 「メモリーカードが　ありません。」: 管理ブロック破損(SSR)。DQ7からメモリーカードが認識されない状態だが、リセットしてPS2本体のブラウザから最後のセーブデータを削除すれば認識される。
- 通常ルート
  - タイトル画面BGMのままTHE END画面表示。羽ペン消滅と同時にタイマーストップ。
- 魚と手紙ルート
  - MapIdに「THE END画面」ではなくエンディング途中のマップを指定。
  - セーブデータ改竄RTAでもDQ7RTAのエンディングの名物である「ペラッペラの魚」と「キーファからのズッ友メール」を楽しめちまうんだ。
  - 主人公の名前がRTAでよく使われる「あ(ぁ)」の場合、手紙の書き出しが「親愛なる　あへ(ぁへ)」になるのも名物のひとつなのだが、セーブーデータ改竄RTAだと「アルスへ」になってしまうのが惜しいところ。

### その他

- 細かい短縮ポイントを重箱の隅をつつくように潰していった結果、結構忙しいRTAになってしまった。
- メモリーカードの厳選
  - 「固い」メモリーカードは、引き抜くタイミングが安定しないのでこのRTAに不適。
  - タイミングが安定する「ゆるい」メモリーカードがよい。
- 管理ブロックの破損
  - 北米版DQ7で初めて遭遇した。
  - データブロックの破損はそのブロックが壊れた冒険の書扱いされるだけで済むが、管理ブロックの破損はゲームがメモリーカードそのものを認識しなくなる。
  - PS2本体はメモリーカードを認識しており、PS2のブラウザ上から件のデータを削除すれば、ちゃんとゲーム上で認識されるようになる。
