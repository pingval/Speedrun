# [PS版FF8 セーブデータ改竄RTA in 27:46](https://www.youtube.com/watch?v=kpaU4kZxIQ4)

- プレイ日時: 2019年07月08日
- 計測区間: 本体の電源投入からThe End画面の音楽終了まで
- 使用ソフト:
  - RPGツクール3
  - PS版FF8
- 使用本体: PS2(SCPH-90000)
  - FF8でディスク読み込み速度「高速」使用
- 使用コントローラ: Sony SCPH-10010
- 改ざん用のセーブデータ作成を計測区間に含める（事前に作成したセーブデータの利用は禁止！）
- アニメティカでの8ブロックセーブ中のメモリーカードの抜き差しは禁止（事前に作成したセーブデータを利用できる怖れがあるため）

----

## 戦略概要

- アニメティカで、現在のマップをエンディングの再生されるマップ(MapID: 76)に改竄する。現在のDISCもDISC 4に改竄する。FF8でNEW GAMEを選択後なるべく早くセーブし、途中でメモリーカードを引き抜く。そのデータをロードすると、エンディングの砂漠でスコールが彷徨うムービーから始まる。DQ7と比べるといろいろ長くてつらい。
- メモリーカードを抜いた後メニューを閉じてソフトリセットするのと、セーブ途中に本体のリセットボタンを押すのとでは、ソフトリセットのほうが20sほど速かったためソフトリセットを採用。
  - メモカ抜き→メニュー閉じる→ソフトリセット: 50sくらい
  - セーブ中リセット: 1m10sくらい
- PS2電源投入～セーブポイント到達の区間を、連射機を使って高速読み込みありなしで比較すると、設定にかかる時間込みで「あり」のほうが16s速かったため高速読み込みを使用。
  - 高速読み込みあり: 8m43s
  - 高速読み込みなし: 8m59s
- [以下の手順により12mほど速くThe End画面が見れる](https://twitter.com/pingval/status/1147727623432183808)も、ムービーが終わるとデバッグルーム画面に戻るため不採用に(こーゆーの任意コード実行のTASとかでどーゆー扱いなんだろう？)。
  1. デバッグルームの千葉の部屋(MapID: 78)から再開
  1. 左上のリノアに話しかけ、以下の順に選択
      1. ムービーテスト
      1. 壱枚目
      1. 5 ドールアンテナ
  1. エンディングムービーが途中のスタッフロール部分から再生される
  - 実はエンディングムービーは3つのファイルに分かれており、「4 セルフィ紹介」で最初の、「6 カニメカ車破壊」で中間の、「5 ドールアンテナ」で最後のパートが再生される。  
  DISC 4をセットして「壱枚目」を選んでいるのに普通に再生されるのは、まあそういうもんです。

### セーブデータ詳細

[セーブデータエディタHyneのソースコード](https://github.com/myst6re/hyne/blob/07bac0f92a68e5c789a77b7df170ce763352bfbe/SaveData.cpp#L80)参考。以下のアドレスの中身は必須。これら以外は好きに変更して良い(はず)
```
0x4180..0x4181: 0x41d0..0x511fのチェックサム
0x4182..0x4183: ff 08 ;; FF8だけに
0x4ec2..0x4ec3: 4c 00 ;; 現在のMapID: 76
0x4fac: 04 ;; 現在のDISC: 4
0x5120..0x5121: 0x4180..0x4181と同じ
```
- チェックサムは2byte * 2箇所 = 色塗り4マス分。2箇所目はえらい遠くにあり、アニメティカで塗りにくいのでチェックサムは0に調整する。
- チェックサムを返すサブルーチンのアドレスは`80037668..80037718`。アルゴリズムはCRC16/GENIBUS……と見せかけて、[算出に用いる要素数256のテーブルの最後の値が本来`0x1ef0`のところ`0`になっている](https://github.com/myst6re/hyne/blob/07bac0f92a68e5c789a77b7df170ce763352bfbe/SaveData.cpp#L565)ため違う値になる。このせいでチェックサムのhackにえらい難儀してしまった(スキルが足りないので)。
- DQ7ではデータブロックに1フレームでも書き込まれてしまうと壊れた冒険の書となってしまいアウトだったが、FF8では`0x417f`までは書き込まれてもチェックサムに影響が及ばない。メモリーカードへの書き込みは1フレームあたり128byteであり`((0x417f + 1 - 0x4000) / 128).ceil = 3`なので、**FF8セーブデータ改竄のメモリーカード引き抜き猶予時間はDQ7の2f(たぶん)よりも3fだけ長い5f=0.083s(たぶん)**。

以下の色塗りを採用した。
```
  FF: ( 34, 27)
  08: ( 35, 27)
  4C: (258, 38)
  08: ( 35, 39)
  04: (204, 39)
  80: ( 22, 44)
```

以下も候補に上がったが、微妙に遠い(130, 44)のマスを塗る必要があるので不採用とした。
```
  FF: ( 34, 27..28)
  08: ( 35, 27)
  4C: (258, 38)
  04: (204, 39)
  12: (130, 44)
```

その他の色塗り候補:
- [縦長](https://github.com/pingval/Speedrun/blob/master/FF8/checksum0-vertical.txt)
- [横長](https://github.com/pingval/Speedrun/blob/master/FF8/checksum0-horizontal.txt)

これはデバッグルーム行きの色塗り(チェックサム未調整)。本当はキャラの座標の調整もすべき。
```
  CE: ( 32, 27)
  83: ( 33, 27)
  FF: ( 34, 27)
  08: ( 35, 27)
  4C: (258, 38)
  04: (204, 39)
  CE: (160, 44)
  83: (161, 44)
```

----

## タイムいろいろ

|区間名|通過|区間|戦闘|備考|
|:---:|:---:|:---:|:---:|:---:|
|電源投入|00:00:00|||
|アニメティカ終了|00:02:09|00:02:09|||
|メモリーカード引き抜き|00:11:01|00:08:52|||
|エンディング終了|00:27:46|00:16:45|||

- 計測地点:
  - アニメティカ終了: アニメティカ起動中にリセットした瞬間

----

## 実際のプレイ

- アニメティカパートはあと10sくらいは縮まるはず。
- セーブポイントに到達した後なぜか2,3sほど棒立ちしてしまった。
- メモカ抜きは一発で成功。うまくいったか確認するのに4,5sロス。
- ソフトリセット時はリセットした時のようにメモリーカードを一旦抜くことによる短縮効果はないのにわざわざ抜き挿ししてしまった。

----

## おわりに

- 移動にアナログスティックを使うことだしPS2でやってるんだからコントローラもPS2純正のを使ってみたがPS純正より十字キーが押しにくいのなんの。
- 今になってわかるゲーム開始直後にセーブできてDISC 1のままエンディングを見れるDQ7のありがたさ。神か？
- 27:30切りは全然可能だろうが、今はそれより他のゲームに手を出したい、セーブまで11分かかるのだるいし。とりあえず次はFF7。……ってFF7もムービーゲーだったわ。

----

## 参考

- [プレイステーション・ＰＡＤ／メモリ・インターフェースの解析](http://kaele.com/~kashima/games/ps_jpn.txt)
- [RPGツクール3を使ったPS1セーブデータの改ざん方法 | RTAPlay!](https://rta-play.info/tool/save-glitch/)
- [巡回冗長検査 - Wikipedia](https://ja.wikipedia.org/wiki/%E5%B7%A1%E5%9B%9E%E5%86%97%E9%95%B7%E6%A4%9C%E6%9F%BB)
- [dearblue/ruby-crc: Pure ruby implemented general CRC (Cyclic Redundancy Check) generator.](https://github.com/dearblue/ruby-crc)
- [Hyne](https://github.com/myst6re/hyne/releases)
- [Deling](https://github.com/myst6re/deling/releases)
